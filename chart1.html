<html>
<script src='https://d3js.org/d3.v5.min.js'></script>
<style> circle {fill: lightblue; stroke: black;} </style>
<body onload="init()">
<div style="margin-top:5px">
<div style="margin-left:30px; width:300px; height:100%; float:left">
<h2>Lung and Bronchus Cancer Rates: 1975-2016</h2>
<p>Here in the right is a figure showing the trend of lung and bronchus cancer from year 1975 to 2016. It displays the incidents rates of each year, in terms of No. of incidents per 100'000 people.</p>
<p>We can see that there is a trend of growth with lung and bronchus cancer incident rate from 1975 to 1990, and then gradually drops after 1990.</p>
<p>What is the reason behind the change? What makes the drop of lung/bronchus cancer rate? Click <b>"Next"</b> for more info.</p>	
</div>
<div style="margin-left:30px; height:100%; float:left">
<svg width=870 height=460>
</svg>
<script>
async function init() {
	const data =  Object.assign((await d3.csv("https://raw.githubusercontent.com/ericstarmars/datavis_yangliu/master/incident_rate_over_year.csv"))
	.map(({year_of_disagnose, incident_rate}) => ({year:year_of_disagnose, value: incident_rate})), 
	{x:"Year", y: "Incidents Per 100'000"});
	var height = 460;
	var width = 870;
	var margin1 = ({top: 50, right: 130, bottom: 30, left: 90});

	var x = d3.scaleLinear()
    .domain(d3.extent(data, d => d.year))
	.nice()
    .range([margin1.left, width - margin1.right])

	var yMarginUp = 4;
	var yMarginDown = 0;
	var y = d3.scaleLinear()
    .domain([d3.min(data, d => d.value) - yMarginUp, d3.max(data, d => d.value) + yMarginDown])
	.nice()
    .range([height - margin1.bottom, margin1.top]);
		
	var line = d3.line()
    .x(d => x(d.year))
    .y(d => y(d.value));

	var xAxis = g1 => g1
    .attr("transform", `translate(0,${height - margin1.bottom})`)
	.style("font-size", "15px")
    .call(d3.axisBottom(x))
	.call(g1 => g1.select(".tick:last-of-type text").clone()
        .attr("x", 55)
		.attr("y", -5)
        .attr("text-anchor", "end")
        .attr("font-weight", "bold")
		.attr("font-size", "16px")
        .text(data.x));

	var yAxis = g2 => g2
    .attr("transform", `translate(${margin1.left},0)`)
	.style("font-size", "15px")
    .call(d3.axisLeft(y))
    .call(g2 => g2.select(".tick:last-of-type text").clone()
        .attr("y", -25)
		.attr("x", -80)
        .attr("text-anchor", "start")
        .attr("font-weight", "bold")
		.attr("font-size", "16px")
        .text(data.y));

	var mysvg = d3.select("svg")
	.attr("viewBox", [0, 0, width, height]);

	mysvg.append("g")
		.call(xAxis);

	mysvg.append("g")
		.call(yAxis);
	  
	mysvg.append("path")
		  .datum(data)
		  .attr("fill", "none")
		  .attr("stroke", "steelblue")
		  .attr("stroke-width", 4)
		  .attr("stroke-linejoin", "miter")
		  .attr("stroke-linecap", "square")
		  .attr("d", line);
}
</script>
</div>
</div>
</body>
</html>	
